\doxysection{src/departamentos.c File Reference}
\hypertarget{departamentos_8c}{}\label{departamentos_8c}\index{src/departamentos.c@{src/departamentos.c}}


Ficheiro que contém as funções de gestão de departamentos.  


{\ttfamily \#include $<$stdio.\+h$>$}\newline
{\ttfamily \#include $<$stdlib.\+h$>$}\newline
{\ttfamily \#include "{}../include/departamentos.\+h"{}}\newline
{\ttfamily \#include "{}../include/input.\+h"{}}\newline
{\ttfamily \#include "{}../include/logs.\+h"{}}\newline
{\ttfamily \#include $<$string.\+h$>$}\newline
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\Hypertarget{departamentos_8c_aadc8e4402c580e1c721bb11f5c99faf6}\label{departamentos_8c_aadc8e4402c580e1c721bb11f5c99faf6} 
\#define {\bfseries CRESCIMENTO\+\_\+5}~5
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \mbox{\hyperlink{departamentos_8c_a748226cfeab27eb714a84125372b10e3}{obter\+Maior\+IDDepartamento}} (\mbox{\hyperlink{struct_departamentos}{Departamentos}} departamentos)
\begin{DoxyCompactList}\small\item\em Identifica o maior ID de departamento presente no sistema. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{departamentos_8c_a0ad7ff89ceac0213201729f27e1c066f}{validar\+\_\+nome\+\_\+departamento}} (\mbox{\hyperlink{struct_departamentos}{Departamentos}} departamentos)
\begin{DoxyCompactList}\small\item\em Valida o nome do departamento introduzido pelo usuário. \end{DoxyCompactList}\item 
char \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{departamentos_8c_adbaf34f68076f02c3dc7a033c5c2aa04}{passar\+\_\+int\+\_\+string}} (Atividade atividade)
\begin{DoxyCompactList}\small\item\em Converte o estado de atividade para texto. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{departamentos_8c_ada912a6c07689e381f92ff7d171e5981}{procurar\+Id\+Departamento}} (\mbox{\hyperlink{struct_departamentos}{Departamentos}} departamentos, int id\+Pretendido)
\begin{DoxyCompactList}\small\item\em Procura o índice de um departamento através do seu ID. \end{DoxyCompactList}\item 
char \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{departamentos_8c_a2ef5a4932d6cccb517fd06e90504758e}{obter\+Numero\+Telemovel}} (void)
\begin{DoxyCompactList}\small\item\em Solicita e valida um número de telemóvel, armazenando-\/o como string dinâmica. \end{DoxyCompactList}\item 
char \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{departamentos_8c_aeebb7d8c3d8b37facbeec42902b6fa9e}{obter\+Email}} (const char \texorpdfstring{$\ast$}{*}msg)
\begin{DoxyCompactList}\small\item\em Solicita, valida e armazena dinamicamente um endereço de e-\/mail. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{departamentos_8c_a70d5d164f1af89dbfc2ddf612b40fce0}{criar\+Departamento}} (\mbox{\hyperlink{struct_departamentos}{Departamentos}} \texorpdfstring{$\ast$}{*}departamentos)
\begin{DoxyCompactList}\small\item\em Solicita dados ao user e cria um novo departamento. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{departamentos_8c_af03d69a7b122157c0a4c374fe2689afb}{listar\+\_\+departamentos}} (\mbox{\hyperlink{struct_departamentos}{Departamentos}} departamentos)
\begin{DoxyCompactList}\small\item\em Função que imprime no ecrã informações de todos os departamentos disponíveis. @detais Percorre o array de departamentos e imprime detalhes de cada um. Caso não hajam registos apresenta uma mensagem informativa. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{departamentos_8c_ac57e7a6999568640f91e130d6dd3dfa7}{atualizar\+\_\+departamento}} (\mbox{\hyperlink{struct_departamentos}{Departamentos}} \texorpdfstring{$\ast$}{*}departamentos)
\begin{DoxyCompactList}\small\item\em Função que permite mudar as informações do departamento introduzidas pelo user. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{departamentos_8c_a1a66bed9f2e57f55b7e57f7721833751}{inativar\+\_\+\+Departamento}} (\mbox{\hyperlink{struct_departamentos}{Departamentos}} \texorpdfstring{$\ast$}{*}departamentos)
\begin{DoxyCompactList}\small\item\em Função para inativar departamentos. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{departamentos_8c_a821d301f5845e36de1a217e6391d70cf}{guardar\+Departamentos}} (\mbox{\hyperlink{struct_departamentos}{Departamentos}} \texorpdfstring{$\ast$}{*}departamentos)
\begin{DoxyCompactList}\small\item\em Guarda todos os dados dos departamentos num ficheiro binário. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{departamentos_8c_a33e2f8cb30ba4947f37d42f559ddc03c}{carregar\+Departamentos}} (\mbox{\hyperlink{struct_departamentos}{Departamentos}} \texorpdfstring{$\ast$}{*}departamentos)
\begin{DoxyCompactList}\small\item\em Recupera os dados dos departamentos a partir de um ficheiro binário. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Ficheiro que contém as funções de gestão de departamentos. 

\begin{DoxyAuthor}{Author}
Francisco Alves 
\end{DoxyAuthor}


\label{doc-func-members}
\Hypertarget{departamentos_8c_doc-func-members}
\doxysubsection{Function Documentation}
\Hypertarget{departamentos_8c_ac57e7a6999568640f91e130d6dd3dfa7}\index{departamentos.c@{departamentos.c}!atualizar\_departamento@{atualizar\_departamento}}
\index{atualizar\_departamento@{atualizar\_departamento}!departamentos.c@{departamentos.c}}
\doxysubsubsection{\texorpdfstring{atualizar\_departamento()}{atualizar\_departamento()}}
{\footnotesize\ttfamily \label{departamentos_8c_ac57e7a6999568640f91e130d6dd3dfa7} 
void atualizar\+\_\+departamento (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_departamentos}{Departamentos}} \texorpdfstring{$\ast$}{*}}]{departamentos}{}\end{DoxyParamCaption})}



Função que permite mudar as informações do departamento introduzidas pelo user. 

Atualiza os dados de um departamento existente.

A função usa procura o ID do departamento e oferece opções para alterar o nome do departamento, nome do responsável do departamento ou o contacto associado ao departamento. 
\begin{DoxyParams}{Parameters}
{\em departamentos} & Apontador para a estrutura que contém a lista de departamentos. \\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
Ao atualizar campos de texto, a função utiliza ler\+String\+Dinamica, obter\+Email ou obter\+Numero\+Telemovel, que alocam nova memória na Heap. 
\end{DoxyNote}
\begin{DoxyWarning}{Warning}
Ao atualizar os campos deve se certificar que se liberta a memoria anterior da heap para evitar erros de memory leak. 
\end{DoxyWarning}
\Hypertarget{departamentos_8c_a33e2f8cb30ba4947f37d42f559ddc03c}\index{departamentos.c@{departamentos.c}!carregarDepartamentos@{carregarDepartamentos}}
\index{carregarDepartamentos@{carregarDepartamentos}!departamentos.c@{departamentos.c}}
\doxysubsubsection{\texorpdfstring{carregarDepartamentos()}{carregarDepartamentos()}}
{\footnotesize\ttfamily \label{departamentos_8c_a33e2f8cb30ba4947f37d42f559ddc03c} 
void carregar\+Departamentos (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_departamentos}{Departamentos}} \texorpdfstring{$\ast$}{*}}]{departamentos}{}\end{DoxyParamCaption})}



Recupera os dados dos departamentos a partir de um ficheiro binário. 

Carrega os departamentos a partir de um ficheiro binário.

Lê o contador de registos e aloca, ajusta a capacidade e aloca o array principal na heap (para evitar memory leaks), reconstroi as strings dinâmicas (nome, responsável, contacto) utilizando a função ler\+String\+Binário(). 
\begin{DoxyParams}{Parameters}
{\em departamentos} & Apontador para a estrutura onde os dados lidos serão carregados. \\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
Se o ficheiro não existir (Por exemplo numa primeira utilização do programa), a função termina silenciosamente. 
\end{DoxyNote}
\begin{DoxyWarning}{Warning}
A função usa várias alocações de memória dinâmica (malloc), pelo que é essencial que a memória seja libertada no final. 
\end{DoxyWarning}
\Hypertarget{departamentos_8c_a70d5d164f1af89dbfc2ddf612b40fce0}\index{departamentos.c@{departamentos.c}!criarDepartamento@{criarDepartamento}}
\index{criarDepartamento@{criarDepartamento}!departamentos.c@{departamentos.c}}
\doxysubsubsection{\texorpdfstring{criarDepartamento()}{criarDepartamento()}}
{\footnotesize\ttfamily \label{departamentos_8c_a70d5d164f1af89dbfc2ddf612b40fce0} 
void criar\+Departamento (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_departamentos}{Departamentos}} \texorpdfstring{$\ast$}{*}}]{departamentos}{}\end{DoxyParamCaption})}



Solicita dados ao user e cria um novo departamento. 

Cria um novo departamento.

Aloca memória dinâmica para o nome, responsável e contacto usando ler\+String\+Dinamica. Incrementa os contadores de departamentos totais e ativos. 
\begin{DoxyParams}{Parameters}
{\em departamentos} & Apontador para a lista onde o departamento está inserido. \\
\hline
\end{DoxyParams}
\Hypertarget{departamentos_8c_a821d301f5845e36de1a217e6391d70cf}\index{departamentos.c@{departamentos.c}!guardarDepartamentos@{guardarDepartamentos}}
\index{guardarDepartamentos@{guardarDepartamentos}!departamentos.c@{departamentos.c}}
\doxysubsubsection{\texorpdfstring{guardarDepartamentos()}{guardarDepartamentos()}}
{\footnotesize\ttfamily \label{departamentos_8c_a821d301f5845e36de1a217e6391d70cf} 
void guardar\+Departamentos (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_departamentos}{Departamentos}} \texorpdfstring{$\ast$}{*}}]{departamentos}{}\end{DoxyParamCaption})}



Guarda todos os dados dos departamentos num ficheiro binário. 

Guarda os departamentos num ficheiro binário.

Serializa a estrutura para o disco, gravando primeiro o contador total e, em seguida, os dados de cada departamento. Utiliza \doxylink{input_8h_a383f1e5a8c2a346c8292f72bbd7c5350}{escrever\+String\+Binario()} para lidar com os campos de texto dinâmicos. 
\begin{DoxyParams}{Parameters}
{\em departamentos} & Apontador para a estrutura que contém os dados a persistir. \\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
Implementa um formato de armazenamento híbrido\+: utiliza campos de tamanho fixo para metadados (ID e estado) e delega a escrita de campos de tamanho variável à função auxiliar \doxylink{input_8h_a383f1e5a8c2a346c8292f72bbd7c5350}{escrever\+String\+Binario()}. 
\end{DoxyNote}
\Hypertarget{departamentos_8c_a1a66bed9f2e57f55b7e57f7721833751}\index{departamentos.c@{departamentos.c}!inativar\_Departamento@{inativar\_Departamento}}
\index{inativar\_Departamento@{inativar\_Departamento}!departamentos.c@{departamentos.c}}
\doxysubsubsection{\texorpdfstring{inativar\_Departamento()}{inativar\_Departamento()}}
{\footnotesize\ttfamily \label{departamentos_8c_a1a66bed9f2e57f55b7e57f7721833751} 
void inativar\+\_\+\+Departamento (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_departamentos}{Departamentos}} \texorpdfstring{$\ast$}{*}}]{departamentos}{}\end{DoxyParamCaption})}



Função para inativar departamentos. 

Inativa um departamento (não remove do array, apenas marca como INATIVO).

A função muda o estado do departamento para inativo para que ele não seja eliminado permanentemente do sistema, permitindo que ele permaneça no histórico do programa. A função utiliza validações para validar o ID do departamento, e para verificar que o mesmo já não está inativo. 
\begin{DoxyParams}{Parameters}
{\em departamentos} & Apontador para a estrutura que contém a lista de departamentos. \\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
A função decrementa o contador \textquotesingle{} departamentos\+Ativos \textquotesingle{} se for bem sucedida. 
\end{DoxyNote}
\Hypertarget{departamentos_8c_af03d69a7b122157c0a4c374fe2689afb}\index{departamentos.c@{departamentos.c}!listar\_departamentos@{listar\_departamentos}}
\index{listar\_departamentos@{listar\_departamentos}!departamentos.c@{departamentos.c}}
\doxysubsubsection{\texorpdfstring{listar\_departamentos()}{listar\_departamentos()}}
{\footnotesize\ttfamily \label{departamentos_8c_af03d69a7b122157c0a4c374fe2689afb} 
void listar\+\_\+departamentos (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_departamentos}{Departamentos}}}]{departamentos}{}\end{DoxyParamCaption})}



Função que imprime no ecrã informações de todos os departamentos disponíveis. @detais Percorre o array de departamentos e imprime detalhes de cada um. Caso não hajam registos apresenta uma mensagem informativa. 

Lista os departamentos registados.


\begin{DoxyParams}{Parameters}
{\em departamentos} & Estrutura que contém a lista de departamentos. \\
\hline
\end{DoxyParams}
\begin{DoxyNote}{Note}
Utiliza a função \doxylink{departamentos_8c_adbaf34f68076f02c3dc7a033c5c2aa04}{passar\+\_\+int\+\_\+string()} para exibir o estado de forma legível. 
\end{DoxyNote}
\Hypertarget{departamentos_8c_aeebb7d8c3d8b37facbeec42902b6fa9e}\index{departamentos.c@{departamentos.c}!obterEmail@{obterEmail}}
\index{obterEmail@{obterEmail}!departamentos.c@{departamentos.c}}
\doxysubsubsection{\texorpdfstring{obterEmail()}{obterEmail()}}
{\footnotesize\ttfamily \label{departamentos_8c_aeebb7d8c3d8b37facbeec42902b6fa9e} 
char \texorpdfstring{$\ast$}{*} obter\+Email (\begin{DoxyParamCaption}\item[{const char \texorpdfstring{$\ast$}{*}}]{msg}{}\end{DoxyParamCaption})}



Solicita, valida e armazena dinamicamente um endereço de e-\/mail. 

Aloca memória na Heap para o e-\/mail e utiliza um ciclo de validação que verifica a existência de exatamente um \textquotesingle{}@\textquotesingle{} e pelo menos um ponto (\textquotesingle{}.\textquotesingle{}). 
\begin{DoxyParams}{Parameters}
{\em msg} & Mensagem a exibir ao utilizador para solicitar o email. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Retorna um apontador (char\texorpdfstring{$\ast$}{*}) para a string alocada na heap. 
\end{DoxyReturn}
\begin{DoxyNote}{Note}
O chamador da função é responsável por libertar a memória com free. 
\end{DoxyNote}
\begin{DoxyWarning}{Warning}
Se a alocação da memória falhar retorna NULL. 
\end{DoxyWarning}
\Hypertarget{departamentos_8c_a748226cfeab27eb714a84125372b10e3}\index{departamentos.c@{departamentos.c}!obterMaiorIDDepartamento@{obterMaiorIDDepartamento}}
\index{obterMaiorIDDepartamento@{obterMaiorIDDepartamento}!departamentos.c@{departamentos.c}}
\doxysubsubsection{\texorpdfstring{obterMaiorIDDepartamento()}{obterMaiorIDDepartamento()}}
{\footnotesize\ttfamily \label{departamentos_8c_a748226cfeab27eb714a84125372b10e3} 
int obter\+Maior\+IDDepartamento (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_departamentos}{Departamentos}}}]{departamentos}{}\end{DoxyParamCaption})}



Identifica o maior ID de departamento presente no sistema. 

Obtém o maior ID existente na lista de departamentos.


\begin{DoxyParams}{Parameters}
{\em departamentos} & Estrutura que contém a lista de departamentos e contador. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Retorna o valor do maior ID encontrado, ou 0 se não houverem departamentos. 
\end{DoxyReturn}
\Hypertarget{departamentos_8c_a2ef5a4932d6cccb517fd06e90504758e}\index{departamentos.c@{departamentos.c}!obterNumeroTelemovel@{obterNumeroTelemovel}}
\index{obterNumeroTelemovel@{obterNumeroTelemovel}!departamentos.c@{departamentos.c}}
\doxysubsubsection{\texorpdfstring{obterNumeroTelemovel()}{obterNumeroTelemovel()}}
{\footnotesize\ttfamily \label{departamentos_8c_a2ef5a4932d6cccb517fd06e90504758e} 
char \texorpdfstring{$\ast$}{*} obter\+Numero\+Telemovel (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Solicita e valida um número de telemóvel, armazenando-\/o como string dinâmica. 

Aloca memória na Heap para 9 dígitos e valida se a entrada contém exclusivamente algarismos. Inclui limpeza do buffer em caso de erro. \begin{DoxyReturn}{Returns}
Retorna um apontador (char\texorpdfstring{$\ast$}{*}) para a string do número ou NULL se a alocação falhar. 
\end{DoxyReturn}
\begin{DoxyNote}{Note}
A memória retornada deve ser libertada com free() pelo chamador. 
\end{DoxyNote}
\begin{DoxyWarning}{Warning}
A leitura é limitada a 9 caracteres para evitar overflow do buffer alocado. 
\end{DoxyWarning}
\Hypertarget{departamentos_8c_adbaf34f68076f02c3dc7a033c5c2aa04}\index{departamentos.c@{departamentos.c}!passar\_int\_string@{passar\_int\_string}}
\index{passar\_int\_string@{passar\_int\_string}!departamentos.c@{departamentos.c}}
\doxysubsubsection{\texorpdfstring{passar\_int\_string()}{passar\_int\_string()}}
{\footnotesize\ttfamily \label{departamentos_8c_adbaf34f68076f02c3dc7a033c5c2aa04} 
char \texorpdfstring{$\ast$}{*} passar\+\_\+int\+\_\+string (\begin{DoxyParamCaption}\item[{Atividade}]{atividade}{}\end{DoxyParamCaption})}



Converte o estado de atividade para texto. 


\begin{DoxyParams}{Parameters}
{\em atividade} & O estado (enum) a converter. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
String correspondente ao estado. 
\end{DoxyReturn}
\Hypertarget{departamentos_8c_ada912a6c07689e381f92ff7d171e5981}\index{departamentos.c@{departamentos.c}!procurarIdDepartamento@{procurarIdDepartamento}}
\index{procurarIdDepartamento@{procurarIdDepartamento}!departamentos.c@{departamentos.c}}
\doxysubsubsection{\texorpdfstring{procurarIdDepartamento()}{procurarIdDepartamento()}}
{\footnotesize\ttfamily \label{departamentos_8c_ada912a6c07689e381f92ff7d171e5981} 
int procurar\+Id\+Departamento (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_departamentos}{Departamentos}}}]{departamentos}{, }\item[{int}]{id\+Pretendido}{}\end{DoxyParamCaption})}



Procura o índice de um departamento através do seu ID. 


\begin{DoxyParams}{Parameters}
{\em departamentos} & Estrutura que contém a lista de departamentos. \\
\hline
{\em id\+Pretendido} & ID que se pretende procurar. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Retorna o indíce do departamento no array, ou -\/1 caso não seja encontrado. 
\end{DoxyReturn}
\Hypertarget{departamentos_8c_a0ad7ff89ceac0213201729f27e1c066f}\index{departamentos.c@{departamentos.c}!validar\_nome\_departamento@{validar\_nome\_departamento}}
\index{validar\_nome\_departamento@{validar\_nome\_departamento}!departamentos.c@{departamentos.c}}
\doxysubsubsection{\texorpdfstring{validar\_nome\_departamento()}{validar\_nome\_departamento()}}
{\footnotesize\ttfamily \label{departamentos_8c_a0ad7ff89ceac0213201729f27e1c066f} 
int validar\+\_\+nome\+\_\+departamento (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{struct_departamentos}{Departamentos}}}]{departamentos}{}\end{DoxyParamCaption})}



Valida o nome do departamento introduzido pelo usuário. 

\begin{DoxyNote}{Note}
O nome é válido caso tenha mais de 3 letras. 
\end{DoxyNote}

\begin{DoxyParams}{Parameters}
{\em departamentos} & Estrutura que contém a lista de departamentos \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Retorna 1 caso tenha sucesso, caso contrário retorna 0. 
\end{DoxyReturn}
